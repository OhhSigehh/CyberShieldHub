<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Final Test - CyberShield</title>
  <link rel="shortcut icon" type="x-icon" href="logo.jpg" />
  <style>
    body { font-family:"Courier New", monospace; background:#0a0a0a; color:#00ff99; margin:0; padding:20px; }
    h1, h2 { text-align:center; text-shadow:0 0 6px #00ff99; }
    .test-box { max-width:900px; margin:20px auto; background:#111; padding:20px;
      border:1px solid #00ff99; border-radius:10px; }
    .question { margin:15px 0; }
    label { display:block; margin:5px 0; cursor:pointer; }
    button { display:block; margin:20px auto; padding:12px 20px; background:#00ff99;
      border:none; border-radius:6px; font-weight:bold; cursor:pointer; }
    button:hover { background:#009966; color:#fff; }
    #result { text-align:center; margin-top:20px; font-size:1.1rem; }
  </style>
</head>
<body>
  <h1>Final Test</h1>
  <div class="test-box">
    <h2>Comprehensive Assessment</h2>
    <p id="testIntro">This is the final test of CyberShield. It covers all 6 lessons. Answer carefully!</p>
    <form id="finalForm"></form>
    <div id="result"></div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDcy8AV_IMrphBOihSwT461C2_CmhHAZi4",
      authDomain: "cshield-41518.firebaseapp.com",
      projectId: "cshield-41518",
      storageBucket: "cshield-41518.firebasestorage.app",
      messagingSenderId: "1055312271929",
      appId: "1:1055312271929:web:c3415a674782ade5550be8"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // --- 50 Question Pool ---
    const questions = [
      { q:"What is phishing?", options:["Fake emails to steal info","Fishing with a net"], correct:0 },
      { q:"What is encryption?", options:["Scrambling data","Deleting data"], correct:0 },
      { q:"Which password is stronger?", options:["Myp@ssW0rd!23","12345"], correct:0 },
      { q:"What does a VPN do?", options:["Secure browsing","Make internet faster"], correct:0 },
      { q:"What is a data breach?", options:["Unauthorized access","Computer update"], correct:0 },
      { q:"Safe Wi-Fi habit?", options:["Use strong password","Leave open"], correct:0 },
      { q:"Why update apps?", options:["Fix security issues","Add viruses"], correct:0 },
      { q:"What is a strong cyber habit?", options:["Think before clicking","Click all links"], correct:0 },
      { q:"Who is responsible for cybersecurity?", options:["Everyone","Only IT"], correct:0 },
      { q:"What helps against ransomware?", options:["Backups","Pay ransom"], correct:0 },
      { q:"What is social engineering?", options:["Tricking people","Programming"], correct:0 },
      { q:"What protects chat apps?", options:["End-to-end encryption","Louder volume"], correct:0 },
      { q:"What is a key in encryption?", options:["Unlocks data","House key"], correct:0 },
      { q:"Safe behavior online?", options:["Check HTTPS","Ignore warnings"], correct:0 },
      { q:"Why backups matter?", options:["Recover lost data","Wastes space"], correct:0 },
      { q:"What should you do with suspicious email?", options:["Report it","Click attachment"], correct:0 },
      { q:"What’s the goal of cybersecurity?", options:["Protect data & people","Slow devices"], correct:0 },
      { q:"Example of sensitive data?", options:["Credit card number","Favorite color"], correct:0 },
      { q:"Why use unique passwords?", options:["Reduce breach risk","Annoy user"], correct:0 },
      { q:"Final step in defense?", options:["Awareness & practice","Luck"], correct:0 },
      { q:"What is malware?", options:["Malicious software","Computer wallpaper"], correct:0 },
      { q:"What is spyware?", options:["Software that steals info","Good antivirus"], correct:0 },
      { q:"What’s a firewall?", options:["Network barrier","Building wall"], correct:0 },
      { q:"Why use 2FA?", options:["Extra security","Faster login"], correct:0 },
      { q:"What is Trojan malware?", options:["Disguised harmful software","A secure program"], correct:0 },
      { q:"Best way to secure public Wi-Fi?", options:["Use VPN","Trust strangers"], correct:0 },
      { q:"What is brute force attack?", options:["Guessing passwords","Forcing door open"], correct:0 },
      { q:"Which is NOT a safe practice?", options:["Sharing passwords","Updating apps"], correct:0 },
      { q:"What is ransomware?", options:["Malware that demands payment","Free security"], correct:0 },
      { q:"What is identity theft?", options:["Stealing personal info","Borrowing an ID card"], correct:0 },
      { q:"Why strong passwords?", options:["Harder to crack","Easier to share"], correct:0 },
      { q:"What’s digital footprint?", options:["Online activity trail","Footprint in sand"], correct:0 },
      { q:"What’s phishing disguised as?", options:["Legit messages","Spam always"], correct:0 },
      { q:"Best way to verify a site?", options:["Check HTTPS & URL","Click random ads"], correct:0 },
      { q:"What is keylogging?", options:["Recording keystrokes","Typing fast"], correct:0 },
      { q:"What is a worm in cybersecurity?", options:["Self-spreading malware","Garden worm"], correct:0 },
      { q:"What’s shoulder surfing?", options:["Looking over someone’s shoulder","Surfing waves"], correct:0 },
      { q:"Best habit for passwords?", options:["Use password manager","Write on paper"], correct:0 },
      { q:"What is spear phishing?", options:["Targeted phishing attack","Fishing spear"], correct:0 },
      { q:"What is a botnet?", options:["Network of infected devices","Robot party"], correct:0 },
      { q:"How to prevent identity theft?", options:["Protect personal info","Share SSN"], correct:0 },
      { q:"What is antivirus?", options:["Software that removes malware","A disease"], correct:0 },
      { q:"What’s adware?", options:["Software showing ads","Free blocker"], correct:0 },
      { q:"What is DDoS attack?", options:["Overloading servers","Downloading games"], correct:0 },
      { q:"Which is private info?", options:["Home address","Favorite food"], correct:0 },
      { q:"What is spoofing?", options:["Imitating another system","Making fun"], correct:0 },
      { q:"What is pharming?", options:["Redirecting to fake sites","Growing plants"], correct:0 },
      { q:"What does HTTPS mean?", options:["Secure website","Fast internet"], correct:0 },
      { q:"What’s cyberbullying?", options:["Harassment online","Friendly messages"], correct:0 },
      { q:"What’s ethical hacking?", options:["Authorized security testing","Illegal hacking"], correct:0 }
    ];

    function shuffle(arr){ for(let i=arr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]];} return arr;}

    async function loadFinalTest(user) {
      const ref = doc(db, "users", user.uid, "progress", "lessons");
      const snap = await getDoc(ref);

      if (snap.exists() && snap.data().finalTest) {
        // Already taken
        document.getElementById("finalForm").innerHTML = "";
        document.getElementById("testIntro").textContent = "⚠ You have already completed the Final Test.";
        document.getElementById("result").innerHTML = `Your score: ${snap.data().finalScore}/25`;
        return;
      }

      // Otherwise, show the test
      const selected = shuffle([...questions]).slice(0,25);
      const form = document.getElementById("finalForm");
      selected.forEach((item,i)=>{
        const div=document.createElement("div");
        div.className="question";
        div.innerHTML=`<b>${i+1}. ${item.q}</b>`;
        item.options.forEach((opt,idx)=>{
          const label=document.createElement("label");
          label.innerHTML=`<input type="radio" name="q${i}" value="${idx}"> ${opt}`;
          div.appendChild(label);
        });
        form.appendChild(div);
      });

      const submitBtn=document.createElement("button");
      submitBtn.type="button";
      submitBtn.textContent="Submit Final Test";
      submitBtn.onclick=()=>submitFinal(user,selected);
      form.appendChild(submitBtn);
    }

    async function submitFinal(user,selected){
      let score=0;
      selected.forEach((item,i)=>{
        const chosen=document.querySelector(`input[name="q${i}"]:checked`);
        if(chosen && parseInt(chosen.value)===item.correct){score++;}
      });

      const result=document.getElementById("result");
      if(score>=20){
        result.innerHTML=`You passed! Score: ${score}/25`;
        if(user){
          const ref=doc(db,"users",user.uid,"progress","lessons");
          const snap=await getDoc(ref);
          let data=snap.exists()?snap.data():{};
          data.finalTest=true;
          data.finalScore=score;
          await setDoc(ref,data);
        }
        localStorage.setItem("lessonPassed","Final Test completed!");
        setTimeout(()=>window.location.href="results.html",2000);
      } else {
        result.innerHTML=`⚠ You scored ${score}/25. You need at least 20 to pass.`;
        setTimeout(()=>window.location.href="results.html",2000);
      }
    }

    onAuthStateChanged(auth,(user)=>{
      if(user){ loadFinalTest(user); }
      else { window.location.href="index.html"; }
    });
  </script>
</body>
</html>
